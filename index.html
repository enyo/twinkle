<!DOCTYPE html>


<title>Polygon Preloader Proof of Concept</title>

<meta charset="utf-8">

<style>
  body {
    background: #111120;
  }
  #mosaic {
    display: block;
    position: absolute;
    left: 50%;
    top: 50%;
    margin-left: -580px;
    margin-top: -340px;
    overflow: hidden;
    width: 1160px;
    height: 680px;

  }
  #mosaic img {
  }
  #mosaic img,
  #mosaic canvas {
    position: absolute;
    top: -60px;
    left: -60px;
    width: 1280px;
    height: 800px;
  }

</style>

<div id="mosaic">
  <img src="school.jpg">
  <canvas width="2560" height="1600"></canvas>
</div>



<script>
  !function() {


    var triangleData = '20,610;20,1330;30,1140:686ec9|20,610;30,1140;60,980:a091dd|60,180;20,610;80,300:6b8dd1|60,680;80,830;80,720:f3abde|20,610;60,980;80,830:daa1d5|60,680;20,610;80,830:f5aee1|30,1140;20,1330;80,1240:9f6e95|20,1330;80,1300;80,1240:d89bb7|70,120;60,180;90,170:f7c7eb|80,1240;80,1300;110,1290:c587be|80,1300;20,1330;90,1390:fbebd2|60,980;30,1140;120,1080:767ccc|80,830;60,980;140,870:b294db|80,1300;90,1390;110,1290:fdf2d5|60,180;80,300;90,170:f1cae6|110,1290;90,1390;170,1370:fcf1d6|90,1390;130,1440;170,1370:fdedd4|170,1370;130,1440;180,1440:fff4e3|30,1140;80,1240;120,1080:b6a7d6|20,610;60,680;200,600:f7c1ec|190,290;140,320;200,310:e7cde4|90,170;80,300;190,290:f3d0ef|80,300;140,320;190,290:d3c7dc|120,1080;80,1240;160,1090:baacd1|90,1390;20,1330;130,1440:feeed5|60,980;120,1080;210,1000:6968b3|120,1080;160,1090;210,1000:34397e|80,830;140,870;180,860:d39ad5|80,300;20,610;140,320:597fb5|170,1370;180,1440;220,1410:fef4da|140,870;60,980;210,1000:767cd3|60,680;80,720;200,600:f6bde9|80,720;80,830;180,860:f3a8da|220,1410;180,1440;250,1430:fdf4e4|180,860;140,870;210,1000:707cc7|210,1000;160,1090;260,1070:2d407a|180,1440;130,1440;260,1590:fde6e6|140,320;20,610;200,600:b3dee0|220,1410;250,1430;270,1390:fffbe3|80,720;180,860;280,770:e7a3da|170,1370;220,1410;270,1390:ffecd5|70,120;90,170;230,10:fdd3f4|90,170;190,290;290,140:f8ccef|230,10;90,170;290,140:fcd4f6|200,600;80,720;280,770:f5bce6|80,1240;110,1290;310,1210:9b70ac|160,1090;80,1240;310,1210:b6a7c0|250,1430;180,1440;260,1590:ffecdf|210,1000;260,1070;320,990:6a62c5|200,310;140,320;320,440:eacee0|140,320;200,600;320,440:5675b2|110,1290;170,1370;310,1210:e3ccdc|260,1070;160,1090;310,1210:dad8cc|260,1070;310,1210;330,1150:5c527a|250,1430;260,1590;340,1510:ffefe3|260,1590;300,1580;340,1510:fcdfdd|170,1370;270,1390;310,1210:fbf0d0|320,440;200,600;350,500:b6e3a1|180,860;210,1000;320,990:303568|250,1430;340,1510;360,1430:fff8e9|270,1390;250,1430;360,1430:fcfae4|340,1380;270,1390;360,1430:fdf3db|280,770;180,860;360,830:515399|180,860;360,830;360,830:7c7c84|350,450;320,440;350,500:7b899d|340,1510;300,1580;350,1580:fde1dc|190,290;200,310;370,260:f8d2f2|370,240;190,290;370,260:f6c6ea|360,130;290,140;370,240:f2d2f5|290,140;190,290;370,240:fbd1f3|180,860;320,990;360,830:242b61|310,1210;270,1390;340,1380:fbf1cd|200,310;320,440;370,260:f9c3f2|230,10;290,140;360,130:e2ccf8|360,830;320,990;360,830:9abf8d|320,990;260,1070;330,1150:70668e|320,440;350,450;420,420:9ebabe|360,130;370,240;400,130:eccff6|320,990;330,1150;440,1030:8577af|350,450;350,500;430,510:5476b0|370,260;320,440;420,420:f7c7eb|280,770;360,830;450,730:464a55|360,830;320,990;450,890:85987b|420,420;350,450;430,510:9ec0c4|430,510;350,500;460,560:8596a1|200,600;280,770;350,500:f4c7ef|400,130;370,240;480,180:ebd1f7|450,730;360,830;480,770:4d545e|450,890;440,1030;470,910:907ac0|350,500;450,730;460,560:8591aa|350,500;280,770;450,730:9068bc|320,990;440,1030;450,890:695679|420,420;430,510;450,420:7260ba|400,130;480,180;500,130:d5c6f3|360,830;450,890;480,770:90aa84|450,890;470,910;510,860:9cb58b|480,770;450,890;510,860:87a17c|300,1580;260,1590;350,1580:fbdbd5|340,1510;350,1580;520,1560:ffece6|370,240;370,260;480,180:f3d3f6|370,260;420,420;450,420:fbd3f5|460,560;450,730;530,660:5847a6|360,1430;340,1510;520,1560:fef4ec|230,10;360,130;400,130:dad6f2|510,860;470,910;550,910:6a6c79|470,910;530,1030;550,910:5345a5|450,730;480,770;530,660:926abc|470,910;510,1040;530,1030:6255b2|470,910;440,1030;510,1040:ae92cc|330,1150;310,1210;580,1250:464068|310,1210;340,1380;580,1250:a5939f|460,560;530,660;580,610:6653a3|440,1030;330,1150;510,1040:b9a8d8|510,1040;330,1150;590,1220:edeac7|330,1150;580,1250;590,1220:816885|370,260;450,420;480,180:f6caed|340,1380;360,1430;620,1340:fdf6d5|580,1250;340,1380;620,1340:f9f0c5|450,420;430,510;620,460:6f5fb6|430,510;460,560;620,460:6d7ec7|580,1250;620,1340;630,1300:fbf4c7|590,1220;580,1250;630,1240:f9efcb|480,180;450,420;630,240:9487dd|630,1240;580,1250;630,1300:faf0ca|360,1430;520,1560;620,1340:fff2e2|460,560;580,610;620,460:493a8b|530,1030;510,1040;650,1090:5860ba|510,1040;590,1220;650,1090:333264|630,50;500,130;650,80:69acfc|500,130;480,180;630,240:cbc9f5|550,910;530,1030;670,1030:352986|530,1030;650,1090;670,1030:4e4bae|500,130;630,240;650,80:66abfc|620,1340;520,1560;640,1540:fdfeef|450,420;620,460;630,240:7466ba|230,10;400,130;630,50:69acfc|400,130;500,130;630,50:66abfc|650,80;630,240;710,140:67aafa|620,460;580,610;710,570:413281|670,460;620,460;710,570:4f3d93|590,1220;630,1240;650,1090:726185|630,50;650,80;730,10:6eaefb|510,860;550,910;750,810:614697|480,770;510,860;750,810:3b2d78|530,660;480,770;750,810:6455ba|630,240;620,460;670,460:7a72c7|670,460;710,570;760,510:f8dba5|550,910;670,1030;750,810:5a459e|580,610;530,660;750,810:503e96|650,80;710,140;730,10:6bacfc|130,1440;20,1330;260,1590:fdf1dc|630,1240;630,1300;810,1330:fbf0c2|630,1300;620,1340;810,1330:fdf7d2|710,570;750,810;810,680:9993a1|810,670;710,570;810,680:e9c2b9|750,810;800,770;810,680:e4cba6|630,240;670,460;810,390:786ac1|670,460;760,510;810,390:6f688f|710,570;580,610;750,810:716b92|810,670;810,680;830,660:847466|830,620;810,670;830,660:fae1a6|630,240;810,390;830,360:7d71c7|760,510;710,570;830,620:58469c|710,570;810,670;830,620:ede7da|620,1340;640,1540;810,1330:fcfff8|640,1540;850,1510;860,1410:ffffec|850,1380;640,1540;860,1410:ffffe8|810,1330;640,1540;850,1380:fef9d6|750,810;670,1030;850,1010:6a51a3|710,140;630,240;880,240:8b87dc|630,240;830,360;880,240:735eaa|670,1030;650,1090;850,1010:4b439e|850,1380;860,1410;890,1380:fdf7d0|830,620;830,660;900,640:fce0a4|850,1010;650,1090;900,1140:946b86|650,1090;630,1240;900,1140:eee9d4|630,1240;810,1330;900,1140:eee9c7|810,1330;850,1380;890,1380:fdf6c9|880,240;830,360;940,320:6a82bf|850,1510;640,1540;880,1530:fefff0|830,620;900,640;950,580:fbe8a8|760,510;830,620;950,580:5d70a7|880,240;940,320;970,230:fdf2c3|850,1010;900,1140;940,990:5e6ac6|830,660;800,770;900,640:4c5b96|860,1410;850,1510;880,1530:ffffec|800,770;750,810;850,1010:434484|810,680;800,770;830,660:938472|880,240;970,230;990,180:fcefbf|810,390;950,580;990,440:fdeeb3|830,360;810,390;990,440:9e8fa7|940,320;830,360;990,440:7478a8|940,990;900,1140;990,1060:6d74cc|810,390;760,510;950,580:9eb5d0|800,770;850,1010;940,990:5653b1|730,10;710,140;880,240:6bacfc|970,230;990,230;990,180:fbedba|970,230;940,320;1010,270:fbf2c4|990,230;970,230;1010,270:fbf0c1|990,1060;900,1140;1020,1110:7578c4|950,580;900,640;1000,590:bcb475|730,10;880,240;990,180:6baefc|810,1330;890,1380;900,1140:fdf7d2|230,10;630,50;730,10:70b0fc|990,180;990,230;1030,190:71b2fb|1010,270;940,320;1030,290:fbf3c3|1020,1110;900,1140;1030,1170:e3e4d5|860,1410;880,1530;890,1380:ffffe2|890,1380;880,1530;1050,1410:fefdda|900,1140;890,1380;1030,1170:f2eec8|990,440;950,580;1000,590:7192de|730,10;990,180;1070,40:6caffb|990,230;1010,270;1030,190:fcf4c4|900,640;800,770;1080,810:6c577c|800,770;940,990;1080,810:8d7da5|940,990;990,1060;1080,980:6c92d5|940,320;990,440;1030,290:6f90d7|1030,290;990,440;1100,380:7094db|990,180;1030,190;1070,40:70b0fb|940,990;1080,980;1080,810:6845ac|1030,1170;890,1380;1050,1410:fdf2c1|1010,270;1030,290;1030,190:fbf5c2|1100,380;990,440;1120,410:b6c1d4|1050,1410;880,1530;1120,1490:ffffe6|1100,980;1080,980;1120,1020:5971b0|990,1060;1020,1110;1120,1020:6e76c9|1080,980;990,1060;1120,1020:7094d7|1000,590;900,640;1080,810:161a4e|990,440;1000,590;1130,520:e9dbab|1050,1410;1120,1490;1140,1400:fffbd1|1070,40;1030,190;1140,150:6faffa|1120,410;990,440;1130,520:fcf0be|1030,1170;1050,1410;1100,1190:ada8bd|1020,1110;1030,1170;1100,1190:edebd5|1050,1410;1140,1400;1160,1350:fefad0|1120,1490;880,1530;1170,1550:fefdda|1100,980;1120,1020;1170,950:6162ba|1100,1190;1050,1410;1160,1350:fcefbf|1090,810;1080,980;1100,980:3b3283|1080,810;1080,980;1090,810:5758a4|1120,1490;1170,1550;1190,1520:fcfee0|1100,1190;1160,1350;1190,1320:f7eec2|1030,190;1030,290;1190,290:fcefbf|1140,150;1030,190;1190,290:7bb5fc|1030,290;1100,380;1190,290:9f8fba|1090,810;1160,820;1190,800:533d83|1090,810;1100,980;1170,950:584aaf|1160,820;1090,810;1170,950:495098|1110,10;1070,40;1140,150:70b2fc|1020,1110;1100,1190;1120,1020:666cc2|730,10;1070,40;1110,10:71affa|1170,950;1120,1020;1210,990:5556a2|1110,10;1140,150;1140,0:73b1fc|1000,590;1080,810;1090,810:676b9d|1140,150;1190,290;1230,200:7cb5fa|1100,380;1120,410;1190,290:fbf2c6|1140,0;1140,150;1240,90:73b1fc|1140,1400;1120,1490;1190,1520:fdfeda|1230,200;1210,290;1250,270:7db6fc|1140,0;1240,90;1250,50:75b3fb|1190,1320;1160,1350;1240,1330:fef2be|1190,290;1210,290;1230,200:faf0cc|1170,950;1210,990;1250,980:5d79b7|1140,150;1230,200;1240,90:74b0fc|1100,1190;1190,1320;1270,1220:7a749c|1190,1320;1270,1310;1270,1220:efedc2|1190,1520;1170,1550;1270,1530:fffeea|1190,1320;1240,1330;1270,1310:fceebd|1130,520;1190,800;1260,730:fff7b4|1190,290;1120,410;1210,290:fbf2c7|1130,520;1090,810;1190,800:ebdcc8|1000,590;1090,810;1130,520:f9eeb4|1190,1520;1270,1530;1290,1500:fffedd|1160,1350;1140,1400;1240,1330:dacaaa|1120,410;1130,520;1300,490:c9beba|1130,520;1260,730;1290,690:e7e3c4|1160,820;1170,950;1190,800:42378a|1120,1020;1100,1190;1310,1070:5c66c3|1100,1190;1270,1220;1310,1070:f1edd5|1210,990;1120,1020;1310,1070:6a8dca|1250,980;1210,990;1310,1070:5952a3|1260,980;1250,980;1310,1070:5553a3|1140,1400;1190,1520;1290,1500:fffedb|1240,1330;1140,1400;1290,1500:f9f4c8|1330,220;1250,270;1330,280:7fb9fb|1230,200;1250,270;1330,220:7db6fc|1290,1500;1270,1530;1330,1540:fffddd|1270,1220;1270,1310;1330,1260:fde2fc|1130,520;1290,690;1300,490:5f82cf|1210,290;1120,410;1300,490:83b2fb|1190,800;1170,950;1250,980:352571|1270,1310;1240,1330;1350,1350:fceebd|1190,800;1250,980;1260,980:332570|1250,270;1210,290;1360,350:8c83cd|1330,280;1250,270;1360,350:82bafb|1210,290;1300,490;1360,350:fdf2c3|1260,980;1310,1070;1370,1040:5d75b7|1360,350;1300,490;1360,450:d6fdff|1330,1260;1270,1310;1350,1350:f8ebbb|1240,1330;1290,1500;1350,1350:fef9cc|1240,90;1230,200;1330,220:7bb5fc|1370,1040;1310,1070;1380,1100:5765c5|1310,1070;1270,1220;1380,1100:7f7ec9|1350,1350;1290,1500;1380,1390:fffdd7|1290,1500;1330,1540;1400,1490:fffeeb|1400,1490;1330,1540;1410,1510:fefbe9|1380,1390;1290,1500;1400,1490:fffdd9|1270,1220;1330,1260;1380,1100:f9f6d8|1360,350;1360,450;1430,380:fef6cb|1360,450;1420,440;1430,380:fef6cd|1290,690;1260,730;1440,810:694ba1|1260,730;1190,800;1440,810:434061|1190,800;1260,980;1440,810:4e429a|1380,1390;1400,1490;1450,1440:fffede|1300,490;1290,690;1450,560:fdf4ba|1360,450;1300,490;1450,560:74628d|1350,1350;1380,1390;1460,1350:eae0c6|1290,690;1450,660;1450,560:b3a3a4|1330,1260;1350,1350;1470,1320:dbcba5|1350,1350;1460,1350;1470,1320:feeebb|1420,440;1360,450;1450,560:84b9fb|1290,690;1440,810;1450,660:6d4da6|1380,1390;1450,1440;1460,1350:fdfedc|1400,1490;1410,1510;1450,1440:fefff0|1250,50;1240,90;1330,220:76b3fb|1270,1530;1170,1550;1330,1540:fbfadf|1450,1440;1410,1510;1480,1450:f3eedb|1260,980;1370,1040;1440,810:48397c|1370,1040;1380,1100;1500,1000:5256b4|1440,810;1370,1040;1500,1000:35235f|1330,220;1330,280;1500,180:80bafc|1470,1320;1460,1350;1490,1320:fbedbc|1250,50;1330,220;1500,180:7bb5fa|1460,1350;1450,1440;1480,1450:fffee1|1330,280;1360,350;1430,380:fbf6cc|1450,660;1440,810;1540,730:62469e|1330,280;1430,380;1500,180:82bafb|1490,1320;1460,1350;1550,1360:faf6de|1380,1100;1330,1260;1470,1320:706970|1490,1320;1550,1360;1560,1340:fef8e1|1460,1350;1480,1450;1550,1360:fefce4|1500,180;1430,380;1530,200:83bbfc|730,10;1110,10;1140,0:73affb|1450,660;1540,730;1590,690:4b4062|1440,810;1500,1000;1600,930:543a91|1480,1450;1410,1510;1590,1500:fffff4|1250,50;1500,180;1610,20:7db6fb|1380,1100;1470,1320;1490,1320:79789d|1590,1500;1410,1510;1620,1560:faf5e2|1500,180;1530,200;1610,180:82bcfc|1530,200;1430,380;1610,370:84bffa|1430,380;1420,440;1610,370:fdf6c7|1550,1360;1480,1450;1590,1500:fcffed|1450,560;1450,660;1630,600:fdf4c8|1450,660;1590,690;1630,600:553d89|1590,690;1540,730;1640,750:6044a1|1420,440;1450,560;1640,460:e5f3e3|1610,370;1420,440;1640,460:fcf7cd|1610,180;1530,200;1650,230:83bbfc|1610,20;1500,180;1610,180:85b8fc|1540,730;1440,810;1600,930:3a3356|1560,1340;1550,1360;1660,1410:fefae2|1550,1360;1590,1500;1660,1410:fdfbf0|1530,200;1610,370;1650,230:83bbfb|1450,560;1630,600;1640,460:9f86a9|1640,460;1630,600;1670,510:dcd3ce|1380,1100;1490,1320;1660,1090:f4efda|1500,1000;1380,1100;1660,1090:525bbd|1540,730;1600,930;1640,750:6045a0|1560,1340;1660,1410;1680,1340:fefae2|1610,20;1610,180;1680,110:82bafb|1600,930;1500,1000;1660,1090:4f50b0|1610,20;1680,110;1690,80:81b9fc|1690,30;1610,20;1690,80:81b9fc|1590,1500;1620,1560;1690,1490:faf7e7|1660,1410;1590,1500;1690,1490:fffdef|1490,1320;1560,1340;1660,1090:f2e4ca|1410,1510;1330,1540;1620,1560:fffde9|1680,1340;1660,1410;1730,1370:fcfae4|1690,1490;1620,1560;1720,1580:f9f4df|1610,180;1650,230;1680,110:82bcfc|1610,370;1640,460;1740,390:86c3fd|1710,1490;1690,1490;1720,1580:f9f8e7|1660,1410;1690,1490;1710,1490:fcfaef|1660,1090;1560,1340;1680,1340:f4e7b8|1630,600;1590,690;1640,750:6349a0|1680,110;1650,230;1760,170:82bcfb|1660,1090;1680,1340;1760,1190:efeed1|1630,600;1640,750;1770,640:5f489a|1640,460;1670,510;1740,390:89c8fd|1650,230;1610,370;1740,390:87c2fd|1660,1410;1710,1490;1730,1370:fcfcf4|1640,750;1760,750;1770,640:664d9d|1600,930;1660,1090;1790,960:4b3ea0|1780,900;1600,930;1790,960:3d366a|1640,750;1600,930;1780,900:674c9d|1670,510;1630,600;1770,640:5f489a|1710,1490;1720,1580;1770,1490:f9f6e4|1690,80;1760,170;1800,120:83bdfc|1760,750;1640,750;1780,900:573e90|1730,1370;1710,1490;1770,1490:fefaf1|1690,80;1680,110;1760,170:82bafb|1800,120;1760,170;1810,130:83bdfc|1800,1060;1760,1190;1810,1150:5355af|1660,1090;1760,1190;1800,1060:535ab8|1790,960;1660,1090;1800,1060:4c4ba5|1650,230;1740,390;1790,360:85c0fc|1810,1150;1760,1190;1810,1210:f7f2df|1810,1150;1810,1210;1830,1190:f8f1df|1770,640;1760,750;1820,660:694ea3|1690,30;1690,80;1800,120:82bafb|1810,1210;1830,1230;1830,1190:7d7488|1810,1210;1730,1370;1830,1230:f4e8be|1760,1190;1730,1370;1810,1210:f6eabf|1760,170;1650,230;1790,360:85c0fc|1680,1340;1730,1370;1760,1190:fdf4d2|1830,1230;1730,1370;1860,1290:7b6a74|1810,130;1760,170;1840,140:84befd|1140,0;1250,50;1610,20:7db6fc|1740,390;1670,510;1880,510:8ac9fc|1670,510;1880,540;1880,510:83aed8|1860,1290;1730,1370;1880,1320:d0cad4|1670,510;1770,640;1880,540:664d9d|1770,640;1820,660;1880,540:7254a6|1800,120;1810,130;1840,140:83bdfc|1800,120;1840,140;1900,100:82bcfb|1840,140;1890,130;1900,100:83bdfc|1780,900;1790,960;1890,880:664c93|1790,360;1740,390;1880,510:87c8fc|1820,660;1760,750;1910,740:694fa6|1760,750;1910,780;1910,740:7152a3|1760,750;1890,880;1910,780:7655a7|1760,750;1780,900;1890,880:7556a3|1690,30;1800,120;1920,30:83b6fb|1800,120;1920,50;1920,30:82bafb|1830,1190;1830,1230;1920,1230:b6b6c2|1830,1230;1860,1290;1920,1230:f0edc9|1800,120;1900,100;1920,50:84befd|1730,1370;1770,1490;1880,1320:fcfdf7|1820,660;1910,740;1920,660:574d89|1790,360;1880,510;1940,460:89cafc|1880,510;1920,490;1940,460:9b7693|1890,130;1840,140;1940,160:83bdfc|1910,780;1890,880;1930,870:7455a4|1880,510;1880,540;1920,490:93d0fc|1880,540;1820,660;1920,660:7556a7|1860,1290;1880,1320;1920,1230:fef5d1|1760,170;1790,360;1840,140:84bffb|1910,740;1910,780;1960,770:4a4161|1900,100;1890,130;1940,160:83bdfc|1800,1060;1810,1150;1970,1070:5657b0|1920,30;1920,50;1970,20:82bafb|1790,360;1940,460;1970,400:89c8fb|1920,660;1910,740;1970,680:6c4ca1|1930,870;1890,880;1980,940:684ea3|1890,880;1790,960;1980,940:7353a8|1980,940;1790,960;1990,970:7455a6|1790,960;1800,1060;1990,970:463b70|1800,1060;1970,1070;1990,970:655fae|1810,1150;1830,1190;1970,1070:5759b3|1830,1190;1920,1230;1970,1070:8863bf|1910,780;1930,870;1960,770:605368|1840,140;1790,360;1940,160:84c0fc|1910,740;1960,770;1970,680:7359a8|1940,160;1790,360;2030,280:85c1fd|1790,360;1970,400;2030,280:87c6fd|1920,50;1940,160;2000,160:84befd|1920,50;1900,100;1940,160:83bdfc|2030,280;1970,400;2040,310:87c6fd|2000,160;1940,160;2030,280:85c1fd|1970,1070;1920,1230;2020,1210:af8ec7|1970,20;1920,50;2000,160:83bdfc|1970,680;1960,770;2060,750:7f60ab|2050,690;1970,680;2060,750:7c5cab|1970,1070;2020,1210;2060,1120:595bb0|2040,310;1970,400;2040,400:88c9fd|2060,1120;2030,1210;2070,1190:d6acce|2020,1210;2030,1210;2060,1120:e8dad7|1970,400;1940,460;2040,400:89cdfd|1970,20;2000,160;2040,150:83bdfc|1920,490;1920,660;1970,680:40447d|1880,540;1920,660;1920,490:6e53a4|2040,310;2040,400;2090,380:88c9fd|2000,160;2030,280;2040,150:85c1fd|1920,1230;1880,1320;2020,1210:f7f0cf|1880,1320;1770,1490;2110,1510:fbfbf1|2090,380;2040,400;2120,470:88cefd|2040,400;1940,460;2120,470:88d0fc|1940,460;1920,490;2120,470:8e6aa7|1920,490;2050,690;2120,470:7854a8|2060,1120;2070,1190;2120,1150:6a63ae|1770,1490;1720,1580;2110,1510:f7eede|1960,770;1930,870;2060,750:8e6aa9|1930,870;1980,940;2060,750:313055|1990,970;1970,1070;2060,1120:635ca9|1920,490;1970,680;2050,690:7955ad|1970,20;2040,150;2160,30:82bcfb|1980,940;1990,970;2160,910:393255|2070,1190;2030,1210;2170,1290:f4f1cd|1990,970;2060,1120;2170,1040:5d5596|2060,750;1980,940;2160,910:7d5aa8|2020,1210;1880,1320;2030,1210:f7f1ce|2120,470;2050,690;2180,620:32345e|2160,910;1990,970;2170,1040:684f74|2060,1120;2120,1150;2170,1040:5552a2|2160,30;2040,150;2190,80:84bffb|2030,1210;1880,1320;2170,1290:faf5d6|1880,1320;2110,1510;2170,1290:fef8d9|2180,620;2200,670;2200,670:8d60ad|2120,1510;2110,1510;2200,1560:e2cecd|2170,1290;2110,1510;2200,1340:fffaed|2050,690;2060,750;2200,670:9064b0|2180,620;2050,690;2200,670:8d5dab|2120,1150;2070,1190;2190,1180:c493c9|2070,1190;2170,1290;2190,1180:f2edcb|2180,620;2200,670;2220,660:7a4f94|2200,670;2200,670;2220,660:80589b|2120,1510;2200,1560;2220,1540:9245ab|2110,1510;2120,1510;2200,1340:f4e5d3|2090,380;2120,470;2200,460:8ad2fd|2090,380;2200,460;2230,380:8ad2fc|2190,1180;2170,1290;2230,1270:f8c7ee|2170,1290;2200,1340;2230,1270:fcf7da|2170,1040;2120,1150;2190,1180:685ea4|2060,750;2160,910;2250,820:885aaa|2200,1340;2120,1510;2250,1410:f9f3de|2120,470;2180,620;2200,460:835ca9|2260,1030;2170,1040;2260,1060:6c69a3|2200,670;2060,750;2250,820:5d4753|2220,1540;2200,1560;2270,1560:492865|2170,1040;2190,1180;2260,1060:635497|2120,1510;2220,1540;2250,1410:825993|2230,380;2200,460;2280,430:8cd3fd|2250,820;2160,910;2280,850:443a5a|2160,910;2260,1030;2270,1020:8462a3|2160,910;2170,1040;2260,1030:785f8d|2040,310;2090,380;2230,380:86ccfb|640,1540;520,1560;880,1530:fefff0|2220,660;2200,670;2290,740:a575ad|2200,670;2250,820;2290,740:514056|2220,1540;2270,1560;2290,1520:9365a2|2260,1060;2190,1180;2300,1130:63589c|2250,1410;2290,1520;2300,1440:f3bbec|2250,1410;2220,1540;2290,1520:8c6b91|2200,460;2180,620;2310,460:8d61ae|2280,430;2200,460;2310,460:8dd2f9|2190,1180;2230,1270;2300,1130:f3edd4|2250,820;2280,850;2290,740:9968a3|2160,910;2270,1020;2280,850:84617e|2260,1030;2260,1060;2270,1020:6a649c|2230,1270;2200,1340;2250,1410:fdf7de|2030,280;2040,310;2230,380:83c6fa|2190,80;2030,280;2230,380:85c5fc|2110,1510;1720,1580;2200,1560:f4e8d9|2040,150;2030,280;2190,80:85c1fd|2220,660;2290,740;2370,640:b17aad|2290,740;2280,850;2370,810:463c5a|2280,430;2310,460;2380,380:8dd4fa|2230,380;2280,430;2380,380:88d3fc|2290,1520;2270,1560;2380,1570:4a2968|2180,620;2220,660;2310,460:9264a1|2310,460;2220,660;2370,640:a168aa|2190,80;2230,380;2400,160:86c5fc|2310,460;2380,470;2380,380:9265ad|2270,1020;2260,1060;2380,1120:907cb4|2260,1060;2300,1130;2380,1120:66589b|2310,460;2370,640;2420,550:6e478d|2380,470;2310,460;2420,550:9562ac|2270,1020;2380,1120;2420,1070:6c5f9c|2380,1120;2390,1120;2420,1070:564b99|2390,1120;2380,1120;2430,1190:524fa4|2300,1130;2230,1270;2430,1190:f3edd6|2380,1120;2300,1130;2430,1190:514fa6|2370,640;2290,740;2430,680:b078a8|2370,640;2430,680;2440,670:b27aaa|2290,740;2370,810;2440,760:705275|2430,680;2290,740;2440,760:54404b|2380,380;2380,470;2440,380:90d8fc|2380,470;2420,550;2430,550:8f62aa|2230,380;2380,380;2400,160:88cefd|2300,1440;2290,1520;2380,1570:4a2c68|2230,1270;2250,1410;2300,1440:fefbf2|2420,1070;2390,1120;2480,1100:504798|2420,550;2370,640;2440,670:a572a6|2430,550;2420,550;2440,670:ae72a1|2390,1120;2430,1190;2480,1100:514c9d|2400,160;2380,380;2500,260:87cffd|2380,380;2440,380;2500,260:87d4fa|2430,680;2440,760;2500,740:a16b96|2230,1270;2300,1440;2430,1190:faf3e1|2280,850;2270,1020;2370,810:865a8e|2440,760;2370,810;2510,810:524155|2440,670;2430,680;2500,740:b173a6|2370,810;2270,1020;2420,1070:9b72a8|1690,30;1920,30;1970,20:84b8fa|2500,740;2440,760;2510,810:a9779c|2440,670;2500,740;2530,670:b47ba9|2380,470;2430,550;2530,420:9367ab|2500,390;2380,470;2530,420:93dbf9|2440,380;2500,390;2500,260:88d5fb|2440,380;2380,470;2500,390:91d8f9|2300,1440;2380,1570;2490,1550:3a205a|230,10;730,10;1140,0:78b1fb|350,1580;260,1590;1170,1550:fff8ef|880,1530;520,1560;1170,1550:ffffff|520,1560;350,1580;1170,1550:fffbf2|1170,1550;260,1590;1720,1580:fdfbe7|1620,1560;1330,1540;1720,1580:fcf8e0|1330,1540;1170,1550;1720,1580:fdfce1|1140,0;1610,20;1970,20:81b6fc|1610,20;1690,30;1970,20:7fb6fc|2270,1560;2200,1560;2380,1570:40235b|2200,1560;1720,1580;2380,1570:dbc1ca|2160,30;2190,80;2400,160:83c1fc|2370,810;2420,1070;2510,810:5a4651|2420,1070;2480,1100;2510,810:8d6ea5|2490,1550;2380,1570;2520,1560:957d92|2500,260;2500,390;2530,420:8ed7fb|2160,30;2400,160;2530,100:84c0fc|2400,160;2500,260;2530,100:85cafb|2500,260;2530,420;2530,100:87d2fd|2430,550;2440,670;2530,670:916f93|2530,420;2430,550;2530,670:9666a5|2500,740;2510,810;2530,670:ba7c96|2300,1440;2490,1550;2550,1380:5a3577|2430,1190;2300,1440;2550,1380:f9f3d4|2490,1550;2520,1560;2550,1380:572f77|2480,1100;2430,1190;2550,1380:f4eed5|2510,810;2480,1100;2550,1380:4d4793|2530,420;2530,670;2550,1380:ab75a0|2530,670;2510,810;2550,1380:ab83b1';

    var triangles = [], canvas, image, ctx;


    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
                                window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;

    var cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame || function() { };



    var width = 2560,
        height = 1600;

    function init() {
      canvas = document.querySelector('#mosaic canvas');
      image = document.querySelector('#mosaic img');
      ctx = canvas.getContext('2d');
      canvas.addEventListener('click', fadeOut);

      parseTriangleData();
      draw();
      twinkle();

      return;
      if (image.complete) fadeOut();
      else {
        twinkle();
        image.onload = fadeOut;
      }
    }

    function parseTriangleData() {
      var splitData = triangleData.split('|');

      splitData.forEach(function(triangleData) {
        var split = triangleData.split(':')
            points = split[0].split(';')
            color = [ parseInt(split[1].substr(0,2), 16), parseInt(split[1].substr(2,2), 16), parseInt(split[1].substr(4,2), 16) ];
            
        var triangle = {
          a: { x: points[0].split(',')[0], y: points[0].split(',')[1] },
          b: { x: points[1].split(',')[0], y: points[1].split(',')[1] },
          c: { x: points[2].split(',')[0], y: points[2].split(',')[1] },
          color: color
        };
        triangles.push(triangle);
      });
    }

    function draw() {

      ctx.clearRect(0, 0, width, height);

      triangles.forEach(function(triangle, idx) {
        drawTriangle(triangle, idx, new Date().getTime());
      });

    }

    function drawTriangle(triangle, idx, now) {
      ctx.beginPath();
      ctx.moveTo( triangle.a.x, triangle.a.y );
      ctx.lineTo( triangle.b.x, triangle.b.y );
      ctx.lineTo( triangle.c.x, triangle.c.y );
      ctx.lineTo( triangle.a.x, triangle.a.y );


      var alpha = 1;
      var fadeOutStart = triangleFadeOutStarts[idx];

      if (fadeOutStart) {
        var fadeOutDuration = now - fadeOutStart;
        if (fadeOutDuration > triangleFadeOutLength) alpha = 0;
        else {
          alpha = 1 - fadeOutDuration / triangleFadeOutLength;
        }
      }

      var color = [ triangle.color[0], triangle.color[1], triangle.color[2] ];
      if (twinklingTriangles[idx] && now - twinklingTriangles[idx] < twinkleDuration) {
        var whitePercentage = 1 - (now - twinklingTriangles[idx]) / twinkleDuration;

        color = [ _whiteColor(color[0], whitePercentage),
                  _whiteColor(color[1], whitePercentage),
                  _whiteColor(color[2], whitePercentage) ];
      }

      // var twinkling = twinklingTriangles.

      ctx.fillStyle = 'rgba(' + color[0] + ',' + color[1] + ',' + color[2] + ', ' + alpha + ')';
      ctx.fill();
      ctx.closePath();
    }

    function _whiteColor(color, percentage) {
      return Math.round((255 - color) * percentage +  color);
    }

    var fadeOutLength = 1500; // ms

    // The shorter the triangle fade out length, the more triangles
    // will disappear separately than all together.
    // 
    // If triangleFadeOutLength equals fadeOutLength, they will all
    // fade out together
    var triangleFadeOutLength = 200; // ms

    // The time between triangles disappearing
    var _fadeOutInterval;

    var fadeOutStart,
        randomizedTriangleIndices = []; // The order in which they will disappear
        triangleFadeOutStarts = {};


    var twinkleAnimationId,
        twinklingTriangles = {},
        twinkleDuration = 2000,
        twinkleInterval = 100
        _lastTwinkleTime = 0; // ms

    function twinkle() {
      twinkleAnimationId = requestAnimationFrame(_twinkleStep);
    }

    function _twinkleStep() {
      if (fadeOutStart) return;

      var lastTwinkleTime = 0,
          now = new Date().getTime();

      if (now - lastTwinkleTime > twinkleInterval) {
        twinklingTriangles[Math.floor(Math.random() * triangles.length)] = now;
        _lastTwinkleTime = now;
      }
      draw();

      twinkleAnimationId = requestAnimationFrame(_twinkleStep);
    }


    function fadeOut() {
      if (fadeOutStart) return;    
      cancelAnimationFrame(twinkleAnimationId);

      fadeOutStart = new Date().getTime();
      // Create the randomized indices
      for (var i = 0; i < triangles.length; i ++) {
        randomizedTriangleIndices.push(i);
      }
      shuffle(randomizedTriangleIndices);

      _fadeOutInterval = fadeOutLength / randomizedTriangleIndices.length;

      requestAnimationFrame(_fadeOutStep);
    }

    function _fadeOutStep() {

      var fadeOutDuration = new Date().getTime() - fadeOutStart;

      // Determine the number of triangles that need to fade out at this moment
      var fadingTriangleCount = fadeOutDuration / _fadeOutInterval;

      for (var i = 0; i < fadingTriangleCount; i++) {
        if (!triangleFadeOutStarts[randomizedTriangleIndices[i]]) {
          triangleFadeOutStarts[randomizedTriangleIndices[i]] = new Date().getTime();
        }
      }

      draw();


      if (fadeOutDuration < fadeOutLength + triangleFadeOutLength*2) {
        requestAnimationFrame(_fadeOutStep);
      }
      else {
        canvas.style.display = 'none';
        image.style.display = 'block';
      }
    }


  function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex ;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {

      // Pick a remaining element...
      randomIndex = Math.floor(Math.random() * currentIndex);
      currentIndex -= 1;

      // And swap it with the current element.
      temporaryValue = array[currentIndex];
      array[currentIndex] = array[randomIndex];
      array[randomIndex] = temporaryValue;
    }

    return array;
  }


    init();
  }();
</script>
